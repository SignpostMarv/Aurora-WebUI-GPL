/*
 Copyright (c) 2010 Nicholas C. Zakas. All rights reserved.
 MIT License
*/
(function(f,b){function d(){this._listeners={}}d.prototype={constructor:d,addListener:function(d,f){this._listeners[d]==b&&(this._listeners[d]=[]);this._listeners[d].push(f);return f},fire:function(b,d){var b="string"==typeof b?{type:b}:{type:b.type},f=b.type,d=d||{},h;for(h in d)b[h]=d[h];b.target=this;if(!f)throw new "Event object missing 'type' property.";if(this._listeners[f]instanceof Array){f=this._listeners[f];for(h=0;h<f.length;h++)f[h].call(this,b)}},removeListener:function(b,d){if(this._listeners[b]instanceof
Array)for(var f=this._listeners[b],h=0,s=f.length;h<s;h++)if(f[h]===d){f.splice(h,1);break}}};f.EventTarget=d})(window);/*
 License and Terms of Use

 Copyright (c) 2011 SignpostMarv

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(f,b){var d=f.Array;d.prototype.indexOf||(d.prototype.indexOf=function(b){for(var c=0;c<this.length;++c)if(this[c]==b)return c;return-1});var n=f.localStorage,q=f.JSON,r={utils:{addClass:function(b,c){var a=(b.className||"").split(" ");-1==a.indexOf(c)&&(a.push(c),b.className=a.join(" ").replace(/^\s+|\s+$/,""))},delClass:function(b,c){var a=(b.className||"").split(" "),m=a.indexOf(c);0<=m&&(a.splice(m,1),b.className=a.join(" ").replace(/^\s+|\s+$/,""))},hasClass:function(b,c){return!b?!1:
0<=(b.className||"").split(" ").indexOf(c)?!0:!1},toggleClass:function(b,c){r.utils[r.utils.hasClass(b,c)?"delClass":"addClass"](b,c)},windowDiscovery:function(l){for(var c=0;c<l.length;++c)if(f[l[c]]!=b)return f[l[c]];return b},empty:function(b){for(;b.hasChildNodes();)b.removeChild(b.firstChild);return b},ctype_digit:function(b){return/^\d+$/.test(b+"")},ctype_float:function(b){return/^(\d+|\d*\.\d+)$/.test(b+"")},createElement:function(b){return document.createElement(b)},createText:function(b){return document.createTextNode(b)}},
gridPoint:function(b,c){this.x=b;this.y=c},size:function(b,c){this.width=Math.max(0,b||0);this.height=Math.max(0,c||0)},bounds:function(l,c){if(!1==l instanceof h)if("object"==typeof l&&l.x!=b&&l.y!=b)l=new h(l.x,l.y);else throw"South-West point should be an instance of mapapi.gridPoint";else if(!1==c instanceof h)if("object"==typeof c&&c.x!=b&&l.y!=b)c=new h(c.x,c.y);else throw"North-East point should be an instance of mapapi.gridPoint";if(l.x>c.x){var a=l.x;l.x=c.x;c.x=a}l.y>c.y&&(a=l.y,l.y=c.y,
c.y=a);this.sw=l;this.ne=c},events:new f.EventTarget},h=r.gridPoint,s=r.bounds,t=r.utils.windowDiscovery,k=r.utils.ctype_float;f.IndexedDB=t(["IndexedDB","mozIndexedDB","webkitIndexedDB"]);f.IDBTransaction=t(["IDBTransaction","webkitIDBTransaction"]);f.IDBObjectStore=t(["IDBObjectStore","webkitIDBObjectStore"]);s.prototype.isWithin=function(b,c){b instanceof h&&(c=b.y,b=b.x);var a=this.sw,m=this.ne;return b>=a.x&&b<=m.x&&c>=a.y&&c<=m.y};s.prototype.equals=function(b){return b instanceof s?this.sw.x==
b.sw.x&&this.sw.y==b.sw.y&&this.ne.x==b.ne.x&&this.ne.y==b.ne.y:!1};s.prototype.intersects=function(b,c){!0!=c&&(c=!1);if(b instanceof s){if(this.isWithin(b.ne)||this.isWithin(b.sw)||this.isWithin(new h(b.sw.x,b.ne.y))||this.isWithin(new h(b.ne.x,b.sw.y)))return!0;if(!1==c)return b.intersects(this,!0)}return!1};h.fuzzy=function(b){if(!(b instanceof h))if(k(b.x)&&k(b.y))b=new h(1*b.x,1*b.y);else if(b instanceof d&&2==b.length&&k(b[0])&&k(b[1]))b=new h(1*b[0],1*b[1]);else throw"value was not an instance of mapapi.gridPoint and was not an object with appropriate properties";
return b};h.prototype.equals=function(b){return b instanceof h&&b.x==this.x&&b.y==this.y};h.prototype.distance=function(b){b=h.fuzzy(b);return Math.sqrt(Math.pow(this.x,2)-Math.pow(b.x,2)+(Math.pow(this.y,2)-Math.pow(b.y,2)))};n&&q&&(t=function(){this.storage=n},t.prototype.getItem=function(b){return q.parse(this.storage.getItem(b))},t.prototype.setItem=function(b,c){return this.storage.setItem(b,q.stringify(c))},r.storage=new t);f.mapapi=r})(window);(function(f,b){function d(b,e){b.prototype=new e;b.prototype.constructor=b}function n(a){c.call(this);this.opts={};for(var e in this.defaultOpts)this.opts[e]=this.defaultOpts[e];a!=b&&this.options(a)}function q(){l.call(this)}function r(b){n.call(this,b)}function h(b){r.call(this,b)}function s(b){h.call(this,b)}function t(b){n.call(this,b)}function k(b){n.call(this,b)}var l=f.Array,c=f.EventTarget,a=f.mapapi,m=a.gridPoint,x=a.bounds,A=a.utils.ctype_digit;if(a==b)throw"mapapi.js is not loaded.";if(c==
b)throw"EventTarget is not loaded";d(n,c);n.prototype.defaultOpts={fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgb(255,255,255)",lineWidth:0};n.prototype.options=function(b){var b=b||{},e;for(e in b)this.opts=b[e]};n.prototype.withinShape=function(b){return b instanceof m?!0:!1};n.prototype.coords=function(a){a!=b&&this.options({coords:a});a=this.opts.coords;return a!=b?a:[]};n.prototype.clickable=function(a){a!=b&&this.options({clickable:!!a});a=this.opts.clickable;return a!=b?a:!1};n.prototype.strokeStyle=
function(b){"string"==typeof b&&this.options({strokeStyle:b});return this.opts.strokeStyle};n.prototype.lineWidth=function(b){"number"==typeof b&&this.options({lineWidth:Math.max(0,b)});return Math.max(0,this.opts.lineWidth)};n.prototype.intersects=function(b){return b instanceof x&&this.bounds instanceof x?this.bounds.intersects(b):!1};a.shape=n;d(q,l);q.prototype.push=function(){for(var b=0;b<arguments.length;++b)if(!(arguments[b]instanceof n))throw"Arguments of mapapi.shapeManager::push() should be instances of mapapi.shape";
l.prototype.push.apply(this,arguments)};q.prototype.intersects=function(b){if(b instanceof x){for(var a=new this.constructor,j=0;j<this.length;++j)this[j].intersects(b)&&a.push(this[j]);return a}throw"Intersection argument must be an instance of mapapi.bounds";};q.prototype.click=function(a){for(var a=m.fuzzy(a),e,j=0;j<this.length&&(!this[j].clickable()||!this[j].withinShape(a)||!(e=this[j].fire("click",{pos:a}),e!=b&&!1==e));++j);};a.shapeManager=q;d(r,n);r.prototype.options=function(a){var a=a||
{},e=a.coords,j=a.fillStyle,u=a.strokeStyle,g=a.lineWidth;if(a.coords!=b)if(e instanceof l){for(var o=0;o<e.length;++o)e[o]=m.fuzzy(e[o]);for(var w=e[0].x,c=e[0].y,d=e[0].x,f=e[0].y,o=1;o<e.length;++o)w=e[o].x<w?e[o].x:w,c=e[o].y<c?e[o].y:c,d=e[o].x>d?e[o].x:d,f=e[o].y>f?e[o].y:f;this.bounds=new x(new m(w,c),new m(d,f));this.opts.coords=e;this.fire("changedcoords")}else throw"coords must be array";"string"==typeof j&&(e=this.opts.fillStyle!=j,this.opts.fillStyle=j,e&&this.fire("changedfillstyle"));
"string"==typeof u&&(e=this.opts.strokeStyle!=u,this.opts.strokeStyle=u,e&&this.fire("changedstrokestyle"));"number"==typeof g&&(e=this.opts.lineWidth!=Math.max(0,g),this.opts.lineWidth=Math.max(0,g),e&&this.fire("changedlinewidth"));a.clickable!=b&&(this.opts.clickable=!!a.clickable)};r.prototype.fillStyle=function(a){a!=b&&this.options({fillStyle:a});return this.opts.fillStyle};n.polygon=r;d(h,r);h.prototype.options=function(a){var a=a||{},e=a.coords;if(e!=b)if(e instanceof l)if(2==e.length){for(var j=
0;j<e.length;++j)e[j]=m.fuzzy(e[j]);var j=e[0],e=e[1],c,g;e.y>j.y&&(c=new m(e.x,j.y),g=new m(j.x,e.y),e=c,j=g);j.x>e.x&&(c=new m(e.x,j.y),g=new m(j.x,e.y),j=c,e=g);a.coords=[j,e]}else throw"When supplying mapapi.shape.rectangle::options with an Array for the coordinates, there should only be two entries";else throw"something other than array was given to mapapi.shape.rectangle::options";r.prototype.options.call(this,a)};h.prototype.withinShape=function(a){if(a==b)throw"Must specify an instance of mapapi.gridPoint";
if(!(this.bounds instanceof x))throw"Coordinates not set";a=m.fuzzy(a);return this.bounds.isWithin(a)};n.rectangle=h;d(s,h);s.prototype.options=function(b){var b=b||{},a=b.coords;if(a instanceof l&&2>=a.length){var j=a[0],a=a[1];if(Math.abs(a.x-j.x)!=Math.abs(a.y-j.y))throw"coordinates should form a square";}h.prototype.options.call(this,b)};n.square=s;d(t,n);t.prototype.defaultOpts={strokeStyle:"rgb(255,255,255)",lineWidth:1};t.prototype.options=function(a){var a=a||{},e=a.coords,j=a.strokeStyle,
c=a.lineWidth;if(a.coords!=b)if(e instanceof l)if(2<=e.length){for(var g=0;g<e.length;++g)e[g]=m.fuzzy(e[g]);this.opts.coords=e;this.fire("changedcoords")}else throw"mapapi.shape.line requires two or more coordinates";else throw"mapapi.shape.line requires coordinates be passed as an array";"string"==typeof j&&(e=this.opts.strokeStyle!=j,this.opts.strokeStyle=j,e&&this.fire("changedstrokestyle"));A(c)&&(c=Math.max(0,1*c),e=this.opts.lineWidth!=c,this.opts.lineWidth=c,e&&this.fire("changedlinewidth"));
a.clickable!=b&&(this.opts.clickable=!!a.clickable)};t.prototype.intersects=function(b){if(b instanceof x)for(var a=this.coords(),j=0;j<a.length;++j)if(b.isWithin(a[j]))return!0;return!1};n.line=t;d(k,n);k.prototype.options=function(a){var e=this.opts,a=a||{},j=a.coords,c=a.radius,g=a.strokeStyle,o=a.lineWidth,w=!1,d=!1;j!=b&&(j[0]=m.fuzzy(j[0]),w=e.coords==b||!pos.equals(e.coords[0]),e.coords=[j[0]]);if(c!=b){if("number"!=typeof c)throw"radius should be specified as a number";if(0>=c)throw"radius should be greater than zero";
d=c!=e.radius;e.radius=c}(w||d)&&this.fire("changedcoords");"string"==typeof fillStyle&&(e=this.opts.fillStyle!=fillStyle,this.opts.fillStyle=fillStyle,e&&this.fire("changedfillstyle"));"string"==typeof g&&(e=this.opts.strokeStyle!=g,this.opts.strokeStyle=g,e&&this.fire("changedstrokestyle"));"number"==typeof o&&(e=this.opts.lineWidth!=Math.max(0,o),this.opts.lineWidth=Math.max(0,o),e&&this.fire("changedlinewidth"));a.clickable!=b&&(this.opts.clickable=!!a.clickable)};k.prototype.radius=function(a){a!=
b&&this.options({radius:a});return this.opts.radius};k.prototype.fillStyle=function(a){a!=b&&this.options({fillStyle:a});return this.opts.fillStyle};k.prototype.withinShape=function(b){b=m.fuzzy(b);return this.coords()[0]instanceof m&&"number"==typeof this.radius()&&this.coords()[0].distance(b)<=this.radius()};k.prototype.intersects=function(b){if(b instanceof x&&this.coords()[0]instanceof m){if(b.isWithin(this.coords()[0]))return!0;if("number"==typeof this.radius())for(var a=b.sw,b=b.ne,a=[a,b,{x:a.x,
y:b.y},{x:b.x,y:a.y}],b=0;b<a.length;++b)if(this.withinShape(a[b]))return!0}return!1};n.circle=k})(window);(function(f,b){function d(b,a){b.prototype=new a;b.prototype.constructor=b}function n(a){if(a!=b){var a=a||{},g=a.container,j=a.renderer,o=a.gridConfig,a=a.markerManager,c=e("div"),d=e("ul");if(a==b)a=new k;else if(!(a instanceof k))throw"marker manager must be an instance of mapapi.markerManager";g==b&&(g=m.body);if(u.renderer==b)throw"mapapi.js core not loaded";if(u.gridConfig==b)throw"mapapi.gridConfig not loaded";if(o==b)throw"no grid config specified";if(o instanceof u.gridConfig)if(j==b){var f=
e("canvas");try{f.getContext&&f.getContext("2d")&&(j=u.renderers.canvas)}catch(l){}j==b&&(j=u.renderers.google3);if(j==b)throw"Could not locate any renderers";j=new j({container:c,gridConfig:o})}else if(j.prototype instanceof u.renderer)j=new j({container:c,gridConfig:o});else throw"Specified renderer is not an instance of mapapi.renderer";else throw"grid config is not an instance of mapapi.gridConfig";J(g);g.appendChild(c);g.appendChild(d);w(g,"mapapi-ui");w(g,"mapapi-ui-"+this.name.toLowerCase().replace(/\s+/g,
""));w(c,"mapapi-ui-renderer");w(d,"mapapi-ui-sidebars");this.renderer=j;this.rendererNode=c;this.contentNode=g;this.sidebars={};this.sidebarLabels=[];this.sidebarsContainer=d;this.markerManager=a;this.ID=F++;this.loadCSS()}}function q(b){if((b=b.sections)&&b instanceof z)for(var g=0;g<b.length;++g)if(b[g]instanceof a){var o=e("li"),m=e("h1"),c=e("ul"),d=b[g],u=d.text();m.appendChild(j(u));m.onclick=function(){y(this.parentNode,"toggled");d.fire("click")};o.appendChild(m);o.appendChild(c);w(o,u.toLowerCase().replace(/[^A-z\d]+/g,
""));w(o,"childless");d.DOM=c;this.DOM.appendChild(o);H(this.DOM.parentNode,"childless");d.addListener("sectionsadded",q);d.addListener("sectionsremoved",r)}}function r(b){var b=b.sections,a=[];if(b&&b instanceof z){for(var e=0;e<b.length;++e){var g=b[e].DOM.parentNode,j=g.parentNode;-1==a.indexOf(j)&&a.push(j);j.removeChild(g)}for(e=0;e<a.length;++e)a[e].hasChildNodes()||w(a[e],"childless")}}function h(){if(x==b)throw"EventTarget not loaded";var a=this,e=a.DOMclasses;x.call(a);a.opts={open:!1};a.rendererEvents=
{focus_changed:[],bounds_changed:[]};a.DOM=b;a.addListener("content_changed",function(){a.DOM=a.content2DOM();for(var b=0;b<e.length;++b)w(a.DOM,e[b]);!0==a.opts.open&&a.open(a.ui)})}function s(a){h.call(this);var a=a||{},e=a.content,g=a.autoFocus==b?!0:!!a.autoFocus,j=Math.max(80,a.maxWidth||0),o=a.position,a=a.zIndex||0;this.opts={};this.content(e);this.position(o);this.maxWidth(j);this.zIndex(a);this.autoFocus=g;this.DOM=b;e!=b&&this.fire("content_changed")}function t(a){h.call(this);if(a!=b){if(A==
b)throw"Your browser does not support the image object";var e=this,a=a||{},j=a.image,o=a.anchor,m=a.position,c=a.infoWindow,d=new A;if(j==b)throw"No marker image specified";if(m==b)throw"No position specified";if(!1==m instanceof g)throw"Invalid position specified";e.position(m);o!=b&&e.anchor(o);e.position(m);d.onload=function(){o==b&&e.anchor({x:d.width/2,y:d.height});e.content(d)};d.onerror=function(){throw"Could not load image";};d.src=j;e.img=d;c instanceof s&&(c.position(e.position()),e.addListener("click",
function(){e.opts.disableAutoShow=!0;e.hide();c.open(e.ui)}),c.addListener("closed",function(){e.opts.disableAutoShow=!1;e.show()}))}}function k(){x.call(this);this.markers=[]}function l(a){t.call(this,a);a!=b&&(this.opts.number=a.number||0)}function c(){x.call(this);this.sections=[];this.DOM=b;this.ID=K++}function a(a){c.call(this);this.opts={};a!=b&&("string"==typeof a&&(a={text:a}),this.options(a));this.DOM=b}f.mapapi=f.mapapi||{};var m=f.document,x=f.EventTarget,A=f.Image,z=f.Array,e=function(a){return m.createElement(a)},
j=function(a){return m.createTextNode(a)},u=f.mapapi,g=u.gridPoint,o=u.utils,w=o?o.addClass:b,H=o?o.delClass:b,y=o?o.toggleClass:b,J=o?o.empty:b,I=/^\s+|\s+$/g,F=0;n.prototype.css=["reset.css","ui.css"];n.prototype.loadCSS=function(){for(var a=m.getElementsByTagName("head")[0],g=a.getElementsByTagName("script"),j=a.getElementsByTagName("link"),o=/./,c=/(mapapi\.ui\.js|mapapi-complete.js)$/,d=/^https?/,w=[],u=[],f,l,h,k=0;k<j.length;++k)/\bstylesheet\b/.test(j[k].rel)&&w.push(j[k]);for(k=0;k<g.length;++k)c.test(g[k].src)&&
(l=g[k].src);if(l==b)throw"Could not find mapapi.js UI file";j=l.replace(c,"");for(k=0;k<n.prototype.css.length;++k)u.push(n.prototype.css[k]);for(k=0;k<this.css.length;++k)u.push(this.css[k]);for(k=0;k<u.length;++k){h=!1;g=u[k];f=g.replace(/\./g,".").replace(/\//g,"/");d.test(g)?o.compile("/^"+f+"$/"):o.compile("^"+j.replace(/\./g,".").replace(/\//g,"/")+f+"$");for(f=0;f<w.length;++f)if(o.test(w[f].href)){h=!0;break}h||(h=e("link"),h.setAttribute("rel","stylesheet"),h.setAttribute("type","text/css"),
h.setAttribute("href",d.test(g)?g:l.replace(c,g)),a.appendChild(h))}};n.prototype.addSidebar=function(a,e){if("string"!=typeof a)throw"sidebar name should be specified as string";if(!(e instanceof c))throw"sidebar object should be an instanceof mapapi.ui.sidebar";a=a.replace(I,"");if(""==a)throw"sidebar name is empty";var g=a.toLowerCase();if(this.sidebars[g]!=b)throw"A sidebar with that name has already been assigned";var j=this.sidebar2DOM(a,e);this.sidebars[g]=e;this.sidebarLabels.push(g);this.sidebarsContainer.appendChild(j);
u.events.fire("sidebaradded",{ui:this,sidebar:e,DOM:j,name:a});return j};n.prototype.sidebar2DOM=function(a,b){if("string"!=typeof a)throw"sidebar name should be specified as string";if(!(b instanceof c))throw"sidebar object should be an instanceof mapapi.ui.sidebar";a=a.replace(I,"");if(""==a)throw"sidebar name is empty";var g=e("li"),j=e("ul");w(g,a.toLowerCase().replace(/\s+/g,""));g.appendChild(j);b.DOM=j;b.addListener("sectionsadded",q);b.addListener("sectionsremoved",r);return g};n.prototype.sidebar=
function(a,e){if("boolean"!=typeof e)e=!1;else if("number"!=typeof a)throw"Sidebar indexes must be specified as integers";var a=Math.floor(a),g=this.sidebarLabels.length;if(1<=g){if(0>a)throw"Negative indexes are not supported";if(a>=g){if(!e)return this.sidebars[this.sidebarLabels[g-1]]}else if(this.sidebarLabels[a]!=b)return this.sidebars[this.sidebarLabels[a]]}return!1};u.ui=n;u.userinterfaces={};d(h,x);h.prototype.DOMclasses=["mapapi-ui-item"];h.prototype.position=function(a){var e=this.opts;
if(a!=b){!1==a instanceof g&&"number"==typeof a.x&&"number"==typeof a.y&&(a=new g(a.x,a.y));if(!1==a instanceof g)throw"No position specified";e.position=a;this.fire("position_changed")}return e.position};h.prototype.hide=function(){this.DOM&&this.DOM.parentNode&&(this.DOM.style.display="none")};h.prototype.show=function(){this.DOM&&this.DOM.parentNode&&(this.DOM.style.display="block")};h.prototype.content=function(a){var e=this.opts;if(a!=b){if("string"!=typeof a&&!a.appendChild&&!(a instanceof A))throw"Contents are invalid";
e.content=a;this.fire("content_changed")}return e.content};h.prototype.content2DOM=function(){var a=this.content(),a=a==b?"":a,g=e("div");if("string"==typeof a)for(var o,a=/\n/.test(a)?a.split("\n"):[a],c=0;c<a.length;++c)o=e("p"),o.appendChild(j(a[c])),g.appendChild(o);else(a.appendChild!=b||a instanceof A)&&g.appendChild(a);w(g,"mapapi-ui-item-contents");return g};h.prototype.csspos=function(){return this.ui.renderer.point2px(this.position())};h.prototype.open=function(a){if(a==b)throw"UI was not supplied";
if(!1==a instanceof u.ui)throw"ui argument is not an instance of mapapi.ui";if(this.DOM!=b&&this.DOM.parentNode!=b&&this.DOM.parentNode==a.contentNode)throw"Already open";if(this.ui!=b&&this.ui!=a)throw"Already open on another UI instance";this.ui=a;var e=this,g=e.DOM,j=a.contentNode;g!=b&&(e.opts.autoFocus&&a.renderer.focus(e.position),j.appendChild(g),j=function(){if(g?g.parentNode==b?b:g.parentNode:b){var j=g.style,o="none"==j.display,c=j.zIndex;o&&(j.zIndex="-1",j.display="block",j.left=0,j.top=
0);var m=e.csspos(),d=g.clientHeight,w=m.y,m=m.x,u=a.renderer.contentNode,k=0<g.clientWidth&&0<=m&&m+g.clientWidth<=u.clientWidth;0<d&&0<=w&&w+d<=u.clientHeight&&k||0==d&&e.ui.renderer.bounds().isWithin(e.position())?(j.top=w+"px",j.left=m+"px",!0!=e.opts.disableAutoShow?e.show():e.hide()):e.hide();o&&(c==b?delete j.zIndex:j.zIndex=c)}},j(),e.rendererEvents.focus_changed.push("focus_changed",a.renderer.addListener("focus_changed",j)),e.rendererEvents.bounds_changed.push("bounds_changed",a.renderer.addListener("bounds_changed",
j)),e.fire("opened"));e.opts.open=!0};h.prototype.close=function(){var a=this.DOM,e=a!=b?a.parentNode:b,g=this.ui,j=this.rendererEvents;a!=b&&e!=b&&e.removeChild(a);if(g&&g.renderer)for(var o in j)for(a=0;a<j[o].length;++a)g.renderer.removeListener(o,j[a]);this.fire("closed");this.opts.open=!1};d(s,h);s.prototype.csspos=function(){var a=h.prototype.csspos.call(this);a.y-=this.DOM!=b&&this.DOM.clientHeight!=b?this.DOM.clientHeight:0;return a};s.prototype.maxWidth=function(a){var e=this.opts;if(a!=
b){if("number"!=typeof a)throw"max width should be a number";e.maxWidth=Math.max(80,a||0)}return e.maxWidth};s.prototype.zIndex=function(a){var e=this.opts;if(a!=b){if("number"!=typeof a)throw"zIndex should be number";e.zIndex=a;this.fire("zIndex_changed")}return e.zIndex};s.prototype.content2DOM=function(){var a=this,g=h.prototype.content2DOM.call(a),o=e("aside"),c=e("div"),m=e("p");w(m,"mapapi-ui-infowindow-close");w(c,"mapapi-ui-wrapper");m.appendChild(j("\u00d7"));m.setAttribute("title","Close");
c.appendChild(g);g.appendChild(m);a.maxWidth()!=b&&(o.style.maxWidth=a.maxWidth());m.onclick=function(){a.close()};o.appendChild(c);return o};s.prototype.DOMclasses=["mapapi-ui-infowindow"];u.infoWindow=s;n.prototype.infoWindow=function(a){return new s(a)};d(t,h);t.prototype.anchor=function(a){if(a!=b){if("number"!=typeof a.x||"number"!=typeof a.y)throw"x and y anchor points must be numbers";this.opts.anchor={x:a.x,y:a.y}}return this.opts.anchor};t.prototype.csspos=function(){var a=h.prototype.csspos.call(this),
e=this.anchor();if(e==b)throw"No anchor point found";a.x-=e.x;a.y-=e.y;return a};t.prototype.content2DOM=function(){var a=this,b=a.content(),g=e("img");if(!(b instanceof A)&&"img"!=b.nodeName.toLowerCase())throw"Invalid contents, must be an instance of Image or an img tag";g.setAttribute("src",b.src);g.onclick=function(){a.fire("click")};return g};t.prototype.DOMclasses=["mapapi-ui-marker"];u.marker=t;d(k,x);k.prototype.add=function(a){if(a==b)throw"No marker specified";if(a instanceof t)-1==this.markers.indexOf(a)&&
this.markers.push(a);else throw"value is not a marker";};k.prototype.remove=function(a){a!=b&&(a=this.markers.indexOf(a),0<=a&&(this.markers[i].close(),this.markers.splice(a,1)))};k.prototype.open=function(a){if(!(a instanceof n))throw"value must be an instance of mapapi.ui";for(var b=0;b<this.markers.length;++b)this.markers[b].open(a);this.fire("opened")};k.prototype.close=function(){for(var a=0;a<this.markers.length;++a)this.markers[a].close();this.fire("closed")};u.markerManager=k;n.prototype.addMarker=
function(a){if(a instanceof t)this.markerManager.add(a);else throw"value must be instance of mapapi.marker";};d(l,t);l.prototype.number=function(a){"number"==typeof a&&(this.opts.number=a,this.fire("content_changed"));return this.opts.number};l.prototype.content2DOM=function(){var a=this,b=t.prototype.content2DOM.call(a),g=a.img,o=e("div"),m=e("p"),c=parseInt(a.opts.number);m.appendChild(j(c));m.setAttribute("title",c);m.onclick=function(){a.fire("click")};H(b,"mapapi-ui-marker");w(b,"mapapi-ui-marker-img");
g&&(o.style.width=g.width+"px",o.style.height=g.height+"px");w(m,"mapapi-ui-marker-number");o.appendChild(b);o.appendChild(m);return o};l.prototype.DOMclasses=["mapapi-ui-marker","mapapi-ui-marker-numbered"];u.numberedMarker=l;var K=0;d(c,x);c.prototype.addSection=function(){for(var e=[],g=0;g<arguments.length;++g)if(arguments[g]instanceof a||arguments[g].prototype!=b&&arguments[g].prototype instanceof a)-1==this.sections.indexOf(arguments[g])&&e.push(arguments[g]);else throw"sub-section should be instanceof mapapi.ui.section";
0<e.length&&(this.sections.push.apply(this.sections,e),this.fire("sectionsadded",{sections:e}))};c.prototype.removeSection=function(){for(var e=[],g=0;g<arguments.length;++g)if(arguments[g]instanceof a||arguments[g].prototype!=b&&arguments[g].prototype instanceof a)-1<this.sections.indexOf(arguments[g])&&e.push(arguments[g]);else throw"sub-section should be instanceof mapapi.ui.section";if(0<e.length){for(g=0;g<e.length;++g)this.sections.splice(this.sections.indexOf(e[g]),1);this.fire("sectionsremoved",
{sections:e})}};n.sidebar=c;d(a,c);a.prototype.options=function(a){var a=a||{},e=this.opts,a=a.text;if(a!=b){if(a+""!=a)throw"text should be a string!";a=a.replace(/^\s+|\s+$/,"");if(""==a)throw"text is empt!";a!=e.text&&(this.fire("changedtext"),e.text=a)}};a.prototype.text=function(a){a!=b&&this.options({text:a});return this.opts.text};n.section=a})(window);(function(f,b){function d(a){l.call(this,a)}var n=f.document,q=f.navigator,r=function(a){return n.createElement(a)},h=function(a){return n.createTextNode(a)},s=function(a,b){return a.appendChild(b)},t=f.mapapi,k=t!=b?t.ui:b,l=t.infoWindow,c=t!=b?t.utils.addClass:b;empty=c?t.utils.empty:b;if(t==b)throw"mapapi.js not loaded";if(k==b)throw"mapapi.ui not loaded";minimalistUI=function(a){function b(){j=!j;t.utils[j?"addClass":"delClass"](l,"minimised");e.title=j?"Show":"Hide";empty(e).appendChild(h(j?
"\u00ab":"\u00bb"))}function d(a){f.smoothZoom()&&!1==/MSIE ([0-9]{1,}[\.0-9]{0,})/.test(q.userAgent)?f.animate({zoom:a},0.5):f.zoom(a)}k.call(this,a);var f=this.renderer,l=this.addSidebar("Menu",new k.sidebar),e=r("div"),j=!1,a=r("li"),u=r("p"),g=r("p");c(e,"toggle-menu");b();e.onclick=b;l.appendChild(e);c(a,"zoomcontrol");s(u,h("+"));s(g,h("\u2013"));u.onclick=function(){d(f.zoom()-1);return!1};g.onclick=function(){d(f.zoom()+1);return!1};s(a,u);s(a,g);s(this.sidebarsContainer,a);t.events.fire("uiready",
{ui:this})};minimalistUI.prototype=new k;minimalistUI.prototype.constructor=minimalistUI;minimalistUI.prototype.name="minimalist";minimalistUI.prototype.description="Provides a minimalist interface to the map.\nUnfinished, made available for feedback.";minimalistUI.prototype.css=["ui/minimalist.css"];t.userinterfaces[minimalistUI.prototype.name]=minimalistUI;d.prototype=new l;d.prototype.constructor=d;d.prototype.csspos=function(){var a=l.prototype.csspos.call(this);a.x-=16;return a};minimalistUI.prototype.infoWindow=
function(a){return new d(a)}})(window);(function(f,b){function d(a){var a=a.pos,b=this.zoom()-1;this.smoothZoom()?this.animate({zoom:b,focus:a},0.5):(this.zoom(b),this.focus(a))}function n(a){this.focus(a.to)}function q(){r.call(this);this.opts={shapes:new h.shapeManager};this._focus=new s(0,0)}f.mapapi=f.mapapi||{};var r=f.EventTarget,h=f.mapapi,s=h.gridPoint,t=h.bounds,k=h.size,l=h.utils.empty,c=h.shape;if(r==b)throw"EventTarget not loaded";q.prototype=new r;q.prototype.constructor=q;q.prototype.browserSupported=!1;q.prototype.options=
function(a){var a=a||{},c=this.opts,d=a.container,f="minZoom,maxZoom,scrollWheelZoom,smoothZoom,draggable,dblclickZoom,zoom,focus,panUnitLR,panUnitUD".split(","),k;a.minZoom=a.minZoom||0;a.maxZoom=a.maxZoom||0;a.panUnitLR=a.panUnitLR||0;a.panUnitUD=a.panUnitUD||0;for(var e=0;e<f.length;++e)if(k=f[e],a[k]!=b)this[k](a[k]);this.addListener("drag",n);this.addListener("click",function(a){c.shapes.click(a.pos)});if(d)if(d.appendChild)c.container=d,this.contentNode&&(this.contentNode.style.width="100%",
this.contentNode.style.height="100%",l(d).appendChild(this.contentNode));else throw"Container is invalid";};q.prototype.minZoom=function(a){var c=this.opts;a!=b&&(c.minZoom=Math.max(0,a));return c.minZoom};q.prototype.maxZoom=function(a){var c=this.opts;a!=b&&(c.maxZoom=Math.max(this.minZoom()+1,a));return c.maxZoom};q.prototype.zoom=function(a){var c=this.opts;a!=b&&(c.zoom=Math.min(Math.max(a,this.minZoom()),this.maxZoom()));return c.zoom};q.prototype.panUnitUD=function(a){var b=this.opts;a&&(b.panUnitUD=
Math.max(a,1));return b.panUnitUD*Math.pow(2,this.zoom())};q.prototype.panUnitLR=function(a){var b=this.opts;a&&(b.panUnitLR=Math.max(a,1));return b.panUnitLR*Math.pow(2,this.zoom())};q.prototype.panTo=function(a,b){"number"==typeof a&&"number"==typeof b?a=new s(a,b):"object"==typeof a&&"number"==typeof a.x&&"number"==typeof a.y&&(a=new s(a.x,a.y));a instanceof s&&(this.bounds().isWithin(a)?this.animate({focus:a},0.5):this.focus(a))};q.prototype.panUp=function(){var a=this.focus();this.panTo(a.x,
a.y+this.panUnitUD())};q.prototype.panDown=function(){var a=this.focus();this.panTo(a.x,a.y-this.panUnitUD())};q.prototype.panLeft=function(){var a=this.focus();this.panTo(a.x-this.panUnitLR(),a.y)};q.prototype.panRight=function(){var a=this.focus();this.panTo(a.x+this.panUnitLR(),a.y)};q.prototype.scrollWheelZoom=function(a){var c=this.opts;a!=b&&(c.scrollWheelZoom=!!a);return c.scrollWheelZoom};q.prototype.smoothZoom=function(a){var c=this.opts;a!=b&&(c.smoothZoom=!!a);return c.smoothZoom};q.prototype.draggable=
function(a){return a!=b?a?!0:!1:a};q.prototype.focus=function(a,c){"number"==typeof a&&(a=new h.gridPoint(a,c),c=this.zoom());c!=b&&this.zoom(c);var d=this.opts;a instanceof h.gridPoint&&(d.focus=a,this.fire("focus_changed",{pos:a,withinBounds:this.bounds().isWithin(a)}));return d.focus};q.prototype.px2point=function(a,b){var c=this.contentNode,d=c.width/2,c=c.height,f=c/2,e=this.tileSize(),d=(a-d)/e.width,c=(c-b-f)/e.height,f=this.focus();mapX=f.x+d;mapY=f.y+c;return new s(mapX,mapY)};q.prototype.point2px=
function(a,b){a instanceof s&&(b=a.y,a=a.x);var c=this.contentNode,d=c.clientWidth/2,c=c.clientHeight/2,f=this.tileSize(),e=this.focus();return{x:d+(a-e.x)*f.width,y:c-(b-e.y)*f.height}};q.prototype.dblclickZoom=function(a){var c=this.opts;a!=b&&(c.dblclickZoom=!!a,this.contentNode&&(a?this.addListener("dblclick",d):this.removeListener("dblclick",d)));return c.dblclickZoom};q.prototype.animate=function(a,c){if(!(a==b||a!=b&&"number"!=typeof c)){var c=!c||0>c?1:c,d=this.zoom(),f=this.minZoom(),k=this.maxZoom(),
e=this.focus(),j=h.gridPoint,u,g;if("number"==typeof a)a={zoom:a};else if(a instanceof j||"object"==typeof a&&"number"==typeof a.x&&"number"==typeof a.y)a={focus:a instanceof j?a:new j(a.x,a.y)};g=!1;a.zoom!=b&&(u="number"==typeof a.zoom?a.zoom:1*a.zoom,u=u!=d&&u>=f&&u<=k?u:b);a.focus instanceof j&&(g=a.focus.x!=e.x||a.focus.y!=e.y?a.focus:!1);k=!!g;if(u!=b||k)f={},u!=b&&(f.zoom=u,f.fromZoom=d),k&&(f.focus=g,f.fromFocus=e),f.start=(new Date).getTime()/1E3,f.end=f.start+c,this.animateOrder=f}};q.prototype.doAnimation=
function(){var a=this.animateOrder;if(!a)return!1;var c=a.zoom,d=a.fromZoom,f=a.focus,k=a.fromFocus,e=a.start,j=a.end,u;if(a){u=(new Date).getTime()/1E3;e=(u-e)/(j-e);if(u>=a.end)return f?this.focus(f,c?c:b):c&&this.zoom(c),this.animateOrder=!1,!0;if(u>a.start)return c=c!=b?d+(c-d)*e:b,f?(a=f?k.x+(f.x-k.x)*e:0,f=f?k.y+(f.y-k.y)*e:0,this.focus(a,f,c)):c!=b&&this.zoom(c),!0}return!1};q.prototype.bounds=function(){var a=this.contentNode,b=this.zoom(),c=0.5+0.5*(1-b%1),d=1<<Math.floor(b),b=this.focus(),
f=a.height,e=this.tileSource.size.height*c/d,a=Math.ceil(a.width/(this.tileSource.size.width*c/d)),c=Math.ceil(f/e),a=Math.ceil(a/2),c=Math.ceil(c/2);return new t({x:b.x-a,y:b.y-c},{x:b.x+a,y:b.y+c})};q.prototype.tileSize=function(){var a=this.zoom(),b=0.5+0.5*(1-a%1),a=1<<Math.floor(a);return new k(this.tileSource.size.width*b/a,this.tileSource.size.height*b/a)};q.prototype.addShape=function(){var a=!1;if(c!=b)for(var d=0;d<arguments.length;++d)arguments[d]instanceof c&&0>this.opts.shapes.indexOf(arguments[d])&&
(a=!0,this.opts.shapes.push(arguments[d]));return a};q.prototype.removeShape=function(){var a=!1;if(c!=b)for(var d=0;d<arguments.length;++d)if(arguments[d]instanceof c){var f=this.opts.shapes.indexOf(arguments[d]);0<=f&&(a=!0,this.opts.shapes.splice(f,1))}return a};q.prototype.shapes=function(){return this.opts.shapes};h.renderer=q;h.renderers={}})(window);(function(f){f.mapapi=f.mapapi||{};var b=f.mapapi,f=function(d){var f=this.options={},d=d||{},q=d.copyright,r=d.label,h=d.minZoom||0,s=d.maxZoom||0,t=d.backgroundColor||"#000000",k=Math.max(1,d.width||256),l=Math.max(1,d.height||k),c=d.mimeType||"image/jpeg",d=Math.max(0,Math.min(1,d.opacity||1));if(q){if(!r)throw"tile source label not specified";}else throw"tile source copyright not specified";this.size=new b.size(k,l);f.copyright=q;f.label=r;f.minZoom=Math.max(h,0);f.maxZoom=Math.max(f.minZoom+
1,s);f.backgroundColor=t;f.mimeType=c;f.opacity=d};f.prototype.getTileURL=function(){return"data:text/plain,"};b.tileSource=f;b.tileSource.prototype.getTileURL=f.prototype.getTileURL})(window);(function(f,b){function d(d,f){f.IndexedDB=d;if(d.objectStoreNames.contains("pos2region")){var c=[],a=Math.floor((new s).getTime()/1E3);d.transaction("pos2region",h.READ).objectStore("pos2region").openCursor().onsuccess=function(f){var l=(f=f.target.result)?f.value:b;if(f)l!==b&&(l.cached==b||"number"!=typeof l.cached||a-l.cached>=t.pos2region)&&c.push(l.pos),f["continue"]();else if(c.length){var q=0,s=function(){q<c.length&&(d.transaction("pos2region",h.READ_WRITE).objectStore("pos2region")["delete"](c[q++]).onsuccess=
s)};s()}}}d.onversionchange=function(){d.close();alert("A new version of this page is ready. Please reload!")}}function n(k){var l=this,k=k||{};l.namespace=k.namespace;l.vendor=k.vendor;l.name=k.name;l.description=k.description||"No description specified";l.label=k.label;l.maxZoom=k.maxZoom;l.size=k.size||new q.size(k.gridWidth||1048576,k.gridHeight||1048576);l.tileSources=k.tileSources||[];l.API={};l.APIcache={};k.pos2region!=b&&(l.API.pos2region=k.pos2region,l.APIcache.pos2region={});k.region2pos!=
b&&(l.API.region2pos=k.region2pos);for(var c=!1,k=[k.pos2region!=b],a=0;a<k.length;++a)if(!0==k[a]){c=!0;break}if(r!=b&&c)try{r.open(l.namespace).onsuccess=function(a){var c=a.target.result;if(c.version=="0.1")d(c,l);else{if(c.version!=""){l.IndexedDB=b;throw"Database version is not upgradable";}a=c.setVersion("0.1");a.onblocked=function(){l.IndexedDB=b;throw"Site is open in other tabs, please close them so the database can be upgraded";};a.onsuccess=function(){var a=c.createObjectStore("pos2region",
{keyPath:"pos"});a.createIndex("region","region",{unique:false});a.createIndex("l_region","l_region",{unique:false});d(c,l)}}}}catch(h){if("NS_ERROR_DOM_INDEXEDDB_UNKNOWN_ERR"!=h.name)throw h;f.console!=b&&console.log("IndexedDB failure. Are you running locally in Firefox? Try debugging in chrome, or load on a localhost web server")}}f.mapapi=f.mapapi||{};var q=f.mapapi,r=f.IndexedDB,h=f.IDBTransaction,s=f.Date,t={pos2region:86400};n.prototype.pos2region=function(d,f,c){var a;this.API.pos2region==
b?a="This grid config has no pos2region API":d==b&&(a="Position was not specified");if(a==b)this.API.pos2region(q.gridPoint.fuzzy(d),f,c);else if(c!=b)c(a);else throw a;};n.prototype.region2pos=function(d,f,c){var a;this.API.region2pos==b?a="This grid config has no region2pos API":d==b&&(a="Region was not specified");if(a==b)this.API.region2pos(d,f,c);else if(c)c(a);else throw a;};n.prototype.apiCacheCheck=function(d){var f=this.APIcache[d],c=1;if(f!=b&&2<=arguments.length){for(c=1;c<arguments.length&&
!(f=f[arguments[c]],f==b);++c);if(c==arguments.length&&f!=b)return f}return b};q.gridConfig=n})(window);/*
 License and Terms of Use

 Copyright (c) 2011 SignpostMarv

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(f,b){function d(a){r.call(this,a);var b=n.createElement("canvas");b&&(b=b.getContext&&b.getContext("2d"));if(!b)throw"Browser does not support canvas renderer";a=a||{};b=a.gridConfig;if(!1==b instanceof h)throw"Grid Configuration object must be instance of mapapi.gridConfig";this.gridConfig=b;this.contentNode=n.createElement("canvas");this.vendorContent=this.contentNode.getContext("2d");q.utils.addClass(this.contentNode,"mapapi-renderer mapapi-renderer-canvas");q.renderer.call(this);a.minZoom=
Math.min(b.maxZoom,a.minZoom||0);a.maxZoom=Math.max(b.maxZoom,a.maxZoom||0);a.zoom=a.zoom||0;a.focus=a.focus||new s(0,0);this.tileSource=b.tileSources[0];this.options(a);this.grid_images={};this.dirty=!0;this.draw(this.opts.fps)}if(f.mapapi){if(!f.mapapi.renderer)throw"mapapi.js renderer class not loaded";}else throw"mapapi.js not loaded";for(var n=f.document,q=f.mapapi,r=q.renderer,h=q.gridConfig,s=q.gridPoint,t=q.bounds,k=["mozRequestAnimationFrame","webkitRequestAnimationFrame"],l=!1,c=q.shape,
a=c!=b?c.polygon:b,m=c!=b?c.rectangle:b,x=c!=b?c.line:b,A=c!=b?c.circle:b,z=0;z<k.length;++z)if(f[k[z]]){k=f[k[z]];l=!0;break}k=l?k:!1;d.prototype=new r;d.prototype.constructor=d;d.prototype.name="2D Canvas";d.prototype.description="Uses the 2D canvas API to render the map as a single image.";z=n.createElement("canvas");d.prototype.browserSupported=z&&z.getContext&&z.getContext("2d");d.prototype.options=function(a){r.prototype.options.call(this,a);for(var c=["fps"],d,g=0;g<c.length;++g)if(d=c[g],
a[d]!=b)obj[d](a[d])};d.prototype.fps=function(a){if("number"==typeof a){var b=this.opts;b.fps=Math.max(1,a)}return b.fps};d.prototype.imageQueued=function(a,b,c){c=Math.floor(c);zoom_b=1<<c;images=this.grid_images;a-=a%zoom_b;return images[c]&&images[c][a]&&images[c][a][b-b%zoom_b]instanceof Image};d.prototype.getImage=function(a,b,c,g){var d=this,c=Math.floor(c),f=1<<c,k=d.grid_images,b=b-b%f,a=a-a%f;if(g=!!g){var h,l;l=c+1;f=a-a%l;h=b-b%l;c<d.maxZoom()&&!d.imageQueued(f,h,l)&&d.getImage(f,h,l)}k[c]||
(k[c]=[]);k[c][a]||(k[c][a]=[]);k[c][a][b]||(k[c][a][b]=new Image,k[c][a][b]._mapapi={x:a,y:b,preloaded:!0==g},k[c][a][b].onload=function(){this._mapapi.loaded=!0;d.bounds().isWithin(this._mapapi.x,this._mapapi.y)&&(d.dirty=!0)},k[c][a][b].src=d.tileSource.getTileURL(new s(a,b),c));return k[c][a][b]};d.prototype.draw=function(e){var e=Math.max(1,e||0),d=this,f=d.bounds();if(d.lastsize==b||d.lastsize.width!=d.contentNode.clientWidth||d.lastsize.height!=d.contentNode.clientHeight)d.lastbounds=b;d.dirty=
d.dirty||d.doAnimation()||d.lastbounds==b||!d.lastbounds.equals(f);(d.lastbounds==b||!d.lastbounds.equals(f))&&d.fire("bounds_changed",{bounds:f});d.lastbounds=f;d.lastsize=new q.size(d.contentNode.clientWidth,d.contentNode.clientHeight);if(d.dirty){var g=d.vendorContent,o=g.canvas;o.width=o.clientWidth;o.height=o.clientHeight;g.save();var w=d.zoom(),h=1<<Math.floor(w),y=d.focus(),n=o.width,r=n/2,F=o.height,z=F/2,B=d.tileSize(),o=B.width,G=B.height,C=f.sw.x-f.sw.x%h,B=f.sw.y-f.sw.y%h,v=new t(new s(C,
B),new s(f.ne.x,f.ne.y));g.fillStyle=d.tileSource.options.backgroundColor;g.fillRect(0,0,n,F);g.translate(y.x*-o+r,y.y*G+z-G*h);g.scale(o,G);for(y=C;y<=f.ne.x;y+=h)for(n=B;n<=f.ne.y;n+=h)r=d.getImage(y,n,w),r._mapapi.loaded&&g.drawImage(r,r._mapapi.x,-r._mapapi.y,h,h);if(c!=b){f=d.shapes().intersects(v);for(B=0;B<f.length;++B)if(w=!1,v=f[B],v instanceof c)if(v.fillStyle!=b&&(g.fillStyle=v.fillStyle()),w=v.lineWidth(),0<w?(g.strokeStyle=v.strokeStyle(),g.lineWidth=w=w/o/h):w=!1,v instanceof m)y=v.bounds.sw.x,
n=v.bounds.ne.y,r=v.bounds.ne.x-y,v=n-v.bounds.sw.y,n=-n+h,g.fillRect(y,n,r,v),0<w&&g.strokeRect(y,n,r,v);else if(v instanceof a){if(v=v.coords(),3<=v.length){g.beginPath();g.moveTo(v[0].x,-v[0].y+h);for(y=1;y<v.length;++y)g.lineTo(v[y].x,-v[y].y+h);g.closePath();g.fill();0<w&&g.stroke()}}else if(v instanceof x&&0<w){if(v=v.coords(),2<=v.length){g.beginPath();g.moveTo(v[0].x,-v[0].y+h);for(y=1;y<v.length;++y)g.lineTo(v[y].x,-v[y].y+h);g.stroke()}}else v instanceof A&&(y=v.coords()[0],v=v.radius(),
y instanceof s&&0<v&&(g.beginPath(),g.arc(y.x,-y.y+h,v,0,2*Math.PI,!0),g.closePath(),g.fill(),0<w&&g.stroke()))}g.restore();d.dirty=!1}l?k(function(){d.draw()}):setTimeout(function(){d.draw(e)},1E3/e)};d.prototype.focus=function(a,c,d){"number"==typeof a&&(a=new s(a,c),c=d);c==b&&(c=this.zoom());a&&r.prototype.focus.call(this,a,c);return r.prototype.focus.call(this)};d.prototype.panTo=function(a,b){"number"==typeof a&&(a=new s(a,b));this.animate({focus:a},0.5)};d.prototype.scrollWheelZoom=function(a){var c=
this,d=c.opts,g=function(a){var b=0;a?a.wheelDelta?(b=a.wheelDelta/120,f.opera&&(b=-b)):a.detail&&(b=-a.detail/3):a=f.event;if(b){var g=c.zoom(),b=0<b?-1:1;c.smoothZoom()?c.animate({zoom:g+b},0.5):c.zoom(g+b)}a.preventDefault&&a.preventDefault();return a.returnValue=!1};a!=b&&(a=!!a,(d.scrollWheelZoom=a)?f.addEventListener?c.contentNode.addEventListener(/WebKit/.test(f.navigator.userAgent)?"mousewheel":"DOMMouseScroll",g,!1):f.attachEvent&&c.contentNode.attachEvent("onmousewheel",g):f.removeEventListener?
c.contentNode.removeEventListener("DOMMouseScroll",g,!1):f.detachEvent&&c.contentNode.detachEvent("onmousewheel",g));return d.scrollWheelZoom};d.prototype.draggable=function(a){var c=this,d=c.opts,g=b,f=function(a){g=c.px2point(a.clientX-this.offsetLeft,a.clientY-this.offsetTop);clearTimeout(c.mousedown_timer);c.dragging=!1;c.mousedown_timer=setTimeout(function(){c.dragging=!0},100)},k=function(a){clearTimeout(c.mousedown_timer);c.dragging||c.fire("click",{pos:c.px2point(a.clientX-this.offsetLeft,
a.clientY-this.offsetTop)});c.mousedown_timer=setTimeout(function(){c.dragging=!1},100)},h=function(a){if(c.dragging){var a=c.px2point(a.clientX-this.offsetLeft,a.clientY-this.offsetTop),b=c.focus();c.fire("drag",{to:new s(b.x-(a.x-g.x),b.y-(a.y-g.y))})}};a!=b&&(a=!!a,(d.draggable=a)?(c.contentNode.addEventListener("mousedown",f,!1),c.contentNode.addEventListener("mouseup",k,!1),c.contentNode.addEventListener("mousemove",h,!1)):(c.contentNode.removeEventListener("mousedown",f,!1),c.contentNode.removeEventListener("mouseup",
k,!1),c.contentNode.removeEventListener("mousemove",h,!1)));return d.draggable};d.prototype.dblclickZoom=function(a){var c=this,d=c.opts,g=function(a){a=c.px2point(a.clientX-this.offsetLeft,a.clientY-this.offsetTop);c.fire("dblclick",{pos:a})};r.prototype.dblclickZoom.call(c,a);a!=b&&(a?c.contentNode.addEventListener("dblclick",g,!1):c.contentNode.removeEventListener("dblclick",g,!1));return d.dblclickZoom};d.prototype.addShape=function(){var a=r.prototype.addShape.apply(this,arguments);this.dirty=
this.dirty?!0:a;return a};d.prototype.removeShape=function(){var a=r.prototype.removeShape.apply(this,arguments);this.dirty=this.dirty?!0:a;return a};q.renderers.canvas=d})(window);/*
 License and Terms of Use

 Copyright (c) 2011 SignpostMarv

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(f,b){function d(c){var d=this,c=c||{},e=c.gridConfig;if(!1==e instanceof l)throw"Grid Configuration object must be instance of mapapi.gridConfig";d.gridConfig=e;d.contentNode=q.createElement("div");r.utils.addClass(d.contentNode,"mapapi-renderer mapapi-renderer-google-v3");r.renderer.call(d,c);d.gridConfig.tileSources[0].options.backgroundColor&&(c.backgroundColor=d.gridConfig.tileSources[0].options.backgroundColor);c.scrollwheel=d.opts.scrollWheelZoom||!0;c.mapTypeControl=c.mapTypeControl||
!1;c.overviewMapControl=c.overviewMapControl||!1;c.panControl=c.panControl||!1;c.rotateControl=c.rotateControl||!1;c.scaleControl=c.scaleControl||!1;c.streetViewControl=c.streetViewControl||!1;c.zoomControl=c.zoomControl||!1;c.disableDoubleClickZoom=!0;d.vendorContent=new s.Map(d.contentNode,c);d.options(c);s.event.addListener(d.vendorContent,"click",function(a){d.fire("click",{pos:d.GLatLng2gridPoint(a.latLng)})});s.event.addListener(d.vendorContent,"bounds_changed",function(){d.fire("bounds_changed",
{bounds:d.bounds()})});s.event.addListener(d.vendorContent,"center_changed",function(){var a=d.focus(),c=d.bounds();c!=b&&d.fire("focus_changed",{pos:a,withinBounds:c.isWithin(a)})});d.scrollWheelZoom(d.opts.scrollWheelZoom);d.smoothZoom(d.opts.smoothZoom);for(var c=!1,f={},j=[],k=0;k<d.gridConfig.tileSources.length;++k){var h=d.gridConfig.tileSources[k],n=h.options.label;j.push(n);f[n]=new s.ImageMapType({maxZoom:h.options.maxZoom,minZoom:h.options.minZoom,tileSize:new s.Size(h.size.width,h.size.height),
isPng:"image/png"==h.options.mimeType,opacity:h.options.opacity,getTileUrl:function(a,b){var c=Math.pow(2,d.convertZoom(b)),g={x:a.x*c,y:a.y*c,zoom:d.convertZoom(b)};g.x-=g.x%c;g.y=-g.y;g.y-=c;g.y-=g.y%c;return h.getTileURL({x:g.x,y:g.y},g.zoom)},alt:n,name:h.options.label});f[n].projection=new a(e);f[n].getTileUrl=h.getTileURL}for(k in f)c=c?c:n,d.vendorContent.mapTypes.set(k,f[k]);d.vendorContent.setOptions({mapTypeIds:j,mapTypeControlOptions:{mapTypeIds:j}});c&&d.vendorContent.setMapTypeId(c);
d.tileSource=e.tileSources[0];d.dblclickZoom(d.opts.dblclickZoom);if(m){var t=function(){d.doAnimation();m(t)};m(t)}else{var u=function(){d.doAnimation();setTimeout(u,1E3/15)};u()}}function n(a,b,c,d){a=1*b;c*=1;d*=1;a=16>a?"0"+a.toString(16):a.toString(16);c=16>c?"0"+c.toString(16):c.toString(16);d=16>d?"0"+d.toString(16):d.toString(16);return"#"+a+c+d}if(f.mapapi){if(!f.mapapi.renderer)throw"mapapi.js renderer class not loaded";}else throw"mapapi.js not loaded";var q=f.document,r=f.mapapi,h=f.google;
if(h==b)throw"Google JS not loaded, check JavaScript permissions";var s=h.maps,t=s.LatLng;if(s==b||t==b)throw"Google Maps API not loaded, check JavaScript permissions";var k=r.renderer,l=r.gridConfig,c=r.gridPoint,a=function(a){this.gridConf=a;this.hscale=180/this.gridConf.size.width;this.vscale=90/this.gridConf.size.height},m=["mozRequestAnimationFrame","webkitRequestAnimationFrame"],h=!1,x=r.shape,A=x.polygon,z=x.rectangle,e=x.square,j=x.line,u=x.circle;a.prototype.fromLatLngToPoint=function(a,
b){var d=b||new c(0,0);d.x=a.lng()/this.hscale;d.y=a.lat()/this.hscale;return d};a.prototype.fromPointToLatLng=function(a){return new t(a.y*this.hscale,a.x*this.hscale)};for(x=0;x<m.length;++x)if(f[m[x]]){m=f[m[x]];h=!0;break}m=h?m:!1;d.prototype=new k;d.prototype.constructor=d;d.prototype.name="Google Maps v3";d.prototype.description="Uses version 3 of Google's Map API to render the map.";d.prototype.browserSupported=!0;d.prototype.options=function(a){k.prototype.options.call(this,a);this.vendorContent.setOptions(a)};
d.prototype.convertZoom=function(a){return this.gridConfig.maxZoom+1-a-1};d.prototype.gridPoint2GLatLng=function(a){var b=180/this.gridConfig.size.height;return new t(0-2*a.y*b,2*a.x*b)};d.prototype.GLatLng2gridPoint=function(a){var b=180/this.gridConfig.size.height;return new c(a.lng()/b/2,a.lat()/b/-2)};d.prototype.panTo=function(a,b){"number"==typeof a&&(a=new c(a,b));this.vendorContent.panTo(this.gridPoint2GLatLng(a))};d.prototype.zoom=function(a){if(this.vendorContent==b)return 0;a!=b&&(this.vendorContent.setZoom(this.convertZoom(a)),
this.fire("bounds_changed",{bounds:this.bounds()}));return this.convertZoom(this.vendorContent.getZoom())};d.prototype.focus=function(a,d,e){"number"==typeof a&&(a=new c(a,d),d=e);a instanceof c&&this.vendorContent.setCenter(this.gridPoint2GLatLng(a));d!=b&&this.zoom(d);return this.GLatLng2gridPoint(this.vendorContent.getCenter())};d.prototype.scrollWheelZoom=function(a){var c=this.opts;a!=b&&(a=!!a,c.scrollWheelZoom=a,this.vendorContent.setOptions({scrollwheel:a}));return this.vendorContent.scrollwheel};
d.prototype.draggable=function(a){var c=this.opts;a!=b&&(a=!!a,c.draggable=a,this.vendorContent.setOptions({draggable:a}));return this.vendorContent.draggable};d.prototype.dblclickZoom=function(a){var c=this,d=c.opts,e=function(a){c.fire("dblclick",{pos:c.GLatLng2gridPoint(a.latLng)})};k.prototype.dblclickZoom.call(c,a);a!=b&&(a?s.event.addListener(c.vendorContent,"dblclick",e):s.event.removeListener(c.vendorContent,"dblclick",e));return d.dblclickZoom};d.prototype.bounds=function(){var a=this.vendorContent.getBounds();
return a==b?b:new r.bounds(this.GLatLng2gridPoint(a.getSouthWest()),this.GLatLng2gridPoint(a.getNorthEast()))};d.prototype.addShape=function(){var a=[e,z,j,A,u],b=!1,d,f=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,h=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\,\s*([0|1]|[0|1]?\.\d+)\s*\)$/;this.zoom();for(var l=0;l<arguments.length;++l){d=arguments[l];b=!1;if(d){for(var m=0;m<a.length;++m)if(d instanceof a[m]||d.prototype instanceof a[m]){b=!0;break}if(!b)throw"A shape in the arguments was not supported";
}else throw"Shape not specified";var t=d.coords(),q=d.strokeStyle(),r=d.fillStyle?d.fillStyle():!1,x,C,v=0,D=0,E=function(){f.test(q)?x=q.replace(f,n):h.test(q)&&(x=q.replace(h,n),v=q.replace(h,function(a,b,c,d,e){return 1*e}));f.test(r)?C=r.replace(f,n):h.test(r)&&(C=r.replace(h,n),D=r.replace(h,function(a,b,c,d,e){return e*1}))};if(d instanceof j||d.prototype instanceof j){b=[];for(m=0;m<t.length;++m)b.push(this.gridPoint2GLatLng(t[m]));E();d.google3=new s.Polyline({path:b,strokeColor:x,strokeOpacity:v,
strokeWidth:d.lineWidth()});d.google3.setMap(this.vendorContent)}else if(d instanceof e||d.prototype instanceof e||d instanceof z||d.prototype instanceof z){b=[t[0],new c(t[0].x,t[1].y),t[1],new c(t[1].x,t[0].y)];for(m=0;m<b.length;++m)b[m]=this.gridPoint2GLatLng(b[m]);E();d.google3=new s.Polygon({path:b,strokeColor:x,strokeOpacity:v,fillColor:C,fillOpacity:D,strokeWidth:d.lineWidth()});d.google3.setMap(this.vendorContent)}else if(d instanceof u||d.prototype instanceof u)E(),d.google3=new s.Circle({center:this.gridPoint2GLatLng(t[0]),
radius:d.radius()/(27500/this.gridConfig.size.width),strokeColor:x,strokeOpacity:v,fillColor:C,fillOpacity:D,strokeWidth:d.lineWidth()}),d.google3.setMap(this.vendorContent);else if(d instanceof A||d.prototype instanceof A){b=[];for(m=0;m<t.length;++m)b.push(this.gridPoint2GLatLng(t[m]));E();d.google3=new s.Polygon({path:b,strokeColor:x,strokeOpacity:v,fillColor:C,fillOpacity:D,strokeWidth:d.lineWidth()});d.google3.setMap(this.vendorContent)}}k.prototype.addShape.apply(this,arguments)};d.prototype.removeShape=
function(){for(var a=0;a<arguments.length;++a)arguments[a].google3!=b&&arguments[a].google3.setMap(null);k.prototype.removeShape.apply(this,arguments)};r.renderers.google3=d})(window);/*
 License and Terms of Use

 Copyright (c) 2012 SignpostMarv

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(f,b){f.mapapi=f.mapapi||{};var d=f.mapapi,n=f.Date,q=d.gridConfig,r=d.tileSource,h=d.size,s=d.gridPoint;d.gridConfigs=d.gridConfigs||{};d.gridConfigs.aurorasim=function(f){var k=f.tileLabel||"Land & Objects",l=f.minZoom||0,c=f.maxZoom||7;backgroundColor=f.backgroundColor||"#1d475f";h=new h(f.gridWidth||1048576,f.gridHeight||1048576);gridLookup=f.gridLookup||{};pos2region={};region2pos={};mapTextureURL=f.mapTextureURL||!1;namespace=f.namespace||!1;vendor=f.vendor||!1;A=f.name||!1;description=
f.description||!1;gridLabel=f.gridLabel||!1;copyright=f.copyright||"\u00a9 "+(new n).getFullYear()+vendor;if(!mapTextureURL||!namespace||!vendor||!A||!description||!gridLabel)throw l=[],mapTextureURL||l.push("mapTextureURL"),namespace||l.push("namespace"),vendor||l.push("vendor"),A||l.push("name"),description||l.push("description"),gridLabel||l.push("gridLabel"),"The following config properties were missing: "+l.join(", ");if(d.gridConfigs[namespace]!=b)throw"A grid config for that namespace has already been specified.";
for(var a in gridLookup){for(var m=gridLookup[a],f=m.x,x=m.y,A=m.Name,z=m.width,e=m.height,m={name:A,uuid:m.UUID,x:f,y:x,width:z,height:e},z=Math.max(z/256,1),e=Math.max(e/256,1),j=f;j<f+z;++j){pos2region[j]=pos2region[j]||{};for(var u=x;u<x+e;++u)pos2region[j][u]=m}region2pos[A.toLowerCase()]=m}k=new r({copyright:copyright,label:k,minZoom:l,maxZoom:c,backgroundColor:backgroundColor});k.getTileURL=function(a,b){if(!mapTextureURL)return null;for(var b=Math.floor(b+1),c=Math.pow(2,b-1),d=a.x,e=a.y,
d=d-d%c,e=e-e%c,f=d;f<d+c;++f)for(var h=e;h<e+c;++h)if(pos2region[f]&&pos2region[f][h])return mapTextureURL.replace("_%x%_",d).replace("_%y%_",e).replace("_%zoom%_",b-1);return null};A=new q({namespace:namespace,vendor:vendor,name:A,description:description,label:gridLabel,size:h,tileSources:[k],minZoom:l,maxZoom:c,pos2region:function(a,c,e){if(!(a instanceof d.gridPoint))throw"Position should be an instance of mapapi.gridPoint";var f=Math.floor(a.x),h=Math.floor(a.y);pos2region[f]&&pos2region[f][h]?
c({pos:p,region:pos2region[f][h].name}):e!=b&&e("No region at coordinates ("+a.x+", "+a.y+")")},region2pos:function(a,c,d){a=a.toLowerCase();region2pos[a]!=b?(d=region2pos[a].name,c({pos:s.fuzzy({x:region2pos[a].x,y:region2pos[a].y}),region:d})):d!=b&&d("No region could be found with the specified name ("+a+")")}});return d.gridConfigs[namespace]=A}})(window);
